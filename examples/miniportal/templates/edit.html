{% extends "admin/base.html" %}
{% import 'admin/static.html' as admin_static with context %}

{% block container_classes %}container-fluid{% endblock %}

{% block head_css %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='jcubic-jquery.splitter/css/jquery.splitter.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='codemirror/codemirror.css') }}">

{% endblock %}

{% block tail_js %}
    {{ super() }}
    <script src="{{ url_for('static', filename='jcubic-jquery.splitter/js/jquery.splitter-0.14.0.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='codemirror/codemirror.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='codemirror/mode/javascript/javascript.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='underscore/underscore.js') }}" type="text/javascript"></script>
    <script>
    $(function() {
        var editor = CodeMirror.fromTextArea($('.codemirror')[0], { lineNumbers: true });
        var render = _.debounce(function() {
            var content = editor.getValue();
            var base_url = '{{ url_for(".render_edit_page") }}';
            var path = '{{ page.path }}';
            $('iframe').attr('src', base_url + '?path=' + encodeURIComponent(path) + '&content=' + encodeURIComponent(content));
        }, 300);
        render();
        editor.on('change', render);

        var row = $('.row');
        row.height(400).split({orientation:'vertical', limit:100, position:'40%'});
    });
    </script>
{% endblock %}


{% block body %}
<div class="row" style="height: 100%">
    
    <div class="col-md-6">
        <textarea class="codemirror" style="width: 100%; height: 100%" >{{ page.raw_content }}</textarea>
    </div>
    <div class="col-md-6" style="height: 100%">
        <iframe frameborder="0" style="width: 100%; height: 97%"></iframe>
    </div>
</div>
{% endblock body %}

